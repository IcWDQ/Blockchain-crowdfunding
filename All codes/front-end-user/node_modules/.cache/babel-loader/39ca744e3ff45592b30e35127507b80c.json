{"ast":null,"code":"import React,{useState,useEffect}from'react';import{provider}from'../../ethers';import axios from'axios';import'./UserUploadProof.css';function UserUploadProof(_ref){let{projectId}=_ref;const[milestoneDescription,setMilestoneDescription]=useState('');const[file,setFile]=useState(null);const[fileName,setFileName]=useState('');const[currentUser,setCurrentUser]=useState('');const[milestoneId,setMilestoneId]=useState(null);const[isSubmitting,setIsSubmitting]=useState(false);const[error,setError]=useState('');useEffect(()=>{const fetchCurrentUser=async()=>{const accounts=await provider.send(\"eth_requestAccounts\",[]);setCurrentUser(accounts[0].toLowerCase());};fetchCurrentUser();},[]);useEffect(()=>{const fetchPendingMilestoneId=async()=>{try{const response=await axios.get(\"http://localhost:3001/api/milestones?projectId=\".concat(projectId,\"&status=pending\"));if(response.data.length>0){const pendingMilestones=response.data;const minMilestoneId=Math.min(...pendingMilestones.map(m=>m.milestoneId));setMilestoneId(minMilestoneId);}else{alert('No pending milestones found for this project.');}}catch(error){console.error('Error fetching pending milestones:',error);}};fetchPendingMilestoneId();},[projectId]);const handleFileChange=e=>{const selectedFile=e.target.files[0];const allowedExtensions=['jpeg','jpg','png','gif'];const fileExtension=selectedFile.name.split('.').pop().toLowerCase();if(!allowedExtensions.includes(fileExtension)){setError('Only jpeg, jpg, png, gif files are allowed');setFile(null);setFileName('');}else{setError('');setFile(selectedFile);setFileName(selectedFile.name);}};const handleSubmit=async event=>{event.preventDefault();if(!file){setError('Please select a file.');return;}if(milestoneId===null){setError('No pending milestone ID found.');return;}try{setIsSubmitting(true);await axios.post('/api/milestones/upload-status',{projectId,isSubmitting:true});const formData=new FormData();formData.append('projectId',projectId);formData.append('milestoneDescription',milestoneDescription);formData.append('milestoneId',milestoneId);formData.append('otherDocument',file);formData.append('currentUser',currentUser);const response=await axios.post('http://localhost:3001/api/userApproveMilestones',formData,{headers:{'Content-Type':'multipart/form-data'}});alert('Milestone proof uploaded successfully');setMilestoneDescription('');setFile(null);setFileName('');setError('');}catch(error){console.error('Error uploading milestone proof:',error);setError(\"Error: \".concat(error.message));}finally{setIsSubmitting(false);await axios.post('/api/milestones/upload-status',{projectId,isSubmitting:false});}};return/*#__PURE__*/React.createElement(\"div\",{className:\"upload-proof-container\"},/*#__PURE__*/React.createElement(\"h2\",null,\"Upload Milestone Proof\"),/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"label\",null,\"Milestone Description: \"),/*#__PURE__*/React.createElement(\"textarea\",{value:milestoneDescription,onChange:e=>setMilestoneDescription(e.target.value),required:true,disabled:isSubmitting})),/*#__PURE__*/React.createElement(\"div\",{className:\"file-input-container\"},/*#__PURE__*/React.createElement(\"label\",{className:\"file-input-label\",htmlFor:\"file-input\"},\"Choose File\",fileName&&/*#__PURE__*/React.createElement(\"span\",{className:\"file-name\"},fileName)),/*#__PURE__*/React.createElement(\"input\",{id:\"file-input\",type:\"file\",onChange:handleFileChange,disabled:isSubmitting,className:\"file-input\"})),error&&/*#__PURE__*/React.createElement(\"p\",{className:\"error\"},error),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",disabled:isSubmitting},isSubmitting?'Submitting...':'Upload')));}export default UserUploadProof;","map":{"version":3,"names":["React","useState","useEffect","provider","axios","UserUploadProof","_ref","projectId","milestoneDescription","setMilestoneDescription","file","setFile","fileName","setFileName","currentUser","setCurrentUser","milestoneId","setMilestoneId","isSubmitting","setIsSubmitting","error","setError","fetchCurrentUser","accounts","send","toLowerCase","fetchPendingMilestoneId","response","get","concat","data","length","pendingMilestones","minMilestoneId","Math","min","map","m","alert","console","handleFileChange","e","selectedFile","target","files","allowedExtensions","fileExtension","name","split","pop","includes","handleSubmit","event","preventDefault","post","formData","FormData","append","headers","message","createElement","className","onSubmit","value","onChange","required","disabled","htmlFor","id","type"],"sources":["/Users/matrix/front-end/src/components/UserUploadProof/UserUploadProof.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { provider } from '../../ethers';\r\nimport axios from 'axios';\r\nimport './UserUploadProof.css';\r\n\r\nfunction UserUploadProof({ projectId }) {\r\n  const [milestoneDescription, setMilestoneDescription] = useState('');\r\n  const [file, setFile] = useState(null);\r\n  const [fileName, setFileName] = useState('');\r\n  const [currentUser, setCurrentUser] = useState('');\r\n  const [milestoneId, setMilestoneId] = useState(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  useEffect(() => {\r\n    const fetchCurrentUser = async () => {\r\n      const accounts = await provider.send(\"eth_requestAccounts\", []);\r\n      setCurrentUser(accounts[0].toLowerCase());\r\n    };\r\n    fetchCurrentUser();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const fetchPendingMilestoneId = async () => {\r\n      try {\r\n        const response = await axios.get(`http://localhost:3001/api/milestones?projectId=${projectId}&status=pending`);\r\n        if (response.data.length > 0) {\r\n          const pendingMilestones = response.data;\r\n          const minMilestoneId = Math.min(...pendingMilestones.map(m => m.milestoneId));\r\n          setMilestoneId(minMilestoneId);\r\n        } else {\r\n          alert('No pending milestones found for this project.');\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching pending milestones:', error);\r\n      }\r\n    };\r\n\r\n    fetchPendingMilestoneId();\r\n  }, [projectId]);\r\n\r\n  const handleFileChange = (e) => {\r\n    const selectedFile = e.target.files[0];\r\n    const allowedExtensions = ['jpeg', 'jpg', 'png', 'gif'];\r\n    const fileExtension = selectedFile.name.split('.').pop().toLowerCase();\r\n\r\n    if (!allowedExtensions.includes(fileExtension)) {\r\n      setError('Only jpeg, jpg, png, gif files are allowed');\r\n      setFile(null);\r\n      setFileName('');\r\n    } else {\r\n      setError('');\r\n      setFile(selectedFile);\r\n      setFileName(selectedFile.name);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n\r\n    if (!file) {\r\n      setError('Please select a file.');\r\n      return;\r\n    }\r\n\r\n    if (milestoneId === null) {\r\n      setError('No pending milestone ID found.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsSubmitting(true);\r\n      await axios.post('/api/milestones/upload-status', { projectId, isSubmitting: true });\r\n\r\n      const formData = new FormData();\r\n      formData.append('projectId', projectId);\r\n      formData.append('milestoneDescription', milestoneDescription);\r\n      formData.append('milestoneId', milestoneId);\r\n      formData.append('otherDocument', file);\r\n      formData.append('currentUser', currentUser);\r\n\r\n      const response = await axios.post('http://localhost:3001/api/userApproveMilestones', formData, {\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data',\r\n        },\r\n      });\r\n\r\n      alert('Milestone proof uploaded successfully');\r\n      setMilestoneDescription('');\r\n      setFile(null);\r\n      setFileName('');\r\n      setError('');\r\n    } catch (error) {\r\n      console.error('Error uploading milestone proof:', error);\r\n      setError(`Error: ${error.message}`);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n      await axios.post('/api/milestones/upload-status', { projectId, isSubmitting: false });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"upload-proof-container\">\r\n      <h2>Upload Milestone Proof</h2>\r\n      <form onSubmit={handleSubmit}>\r\n        <div>\r\n          <label>Milestone Description: </label>\r\n          <textarea\r\n            value={milestoneDescription}\r\n            onChange={(e) => setMilestoneDescription(e.target.value)}\r\n            required\r\n            disabled={isSubmitting}\r\n          />\r\n        </div>\r\n        <div className=\"file-input-container\">\r\n          <label className=\"file-input-label\" htmlFor=\"file-input\">\r\n            Choose File\r\n            {fileName && <span className=\"file-name\">{fileName}</span>}\r\n          </label>\r\n          <input\r\n            id=\"file-input\"\r\n            type=\"file\"\r\n            onChange={handleFileChange}\r\n            disabled={isSubmitting}\r\n            className=\"file-input\"\r\n          />\r\n        </div>\r\n        {error && <p className=\"error\">{error}</p>}\r\n        <button type=\"submit\" disabled={isSubmitting}>\r\n          {isSubmitting ? 'Submitting...' : 'Upload'}\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default UserUploadProof;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}