{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import axios from'axios';import{ethers}from'ethers';import Navbar from'../Navbar/Navbar';import ProjectList from'../ProjectList/ProjectList';import ProjectDetails from'../ProjectDetails/ProjectDetails';import CreateProject from'../CreateProject/CreateProject';import'./Home.css';function Home(){const[projects,setProjects]=useState([]);const[filteredProjects,setFilteredProjects]=useState([]);const[userAddress,setUserAddress]=useState('');const[selectedProject,setSelectedProject]=useState(null);const[activePage,setActivePage]=useState('allProjects');const fetchProjects=async()=>{try{const response=await axios.get('/api/projects');setProjects(response.data);}catch(error){console.error('Error fetching projects:',error);}};const getUserAddress=async()=>{try{await window.ethereum.request({method:'eth_requestAccounts'});const provider=new ethers.providers.Web3Provider(window.ethereum);const signer=provider.getSigner();const address=await signer.getAddress();setUserAddress(address.toLowerCase());}catch(error){console.error('Error getting user address:',error);}};useEffect(()=>{fetchProjects();getUserAddress();},[]);const filterMyProjects=useCallback(()=>{return projects.filter(project=>project.creator.toLowerCase()===userAddress);},[projects,userAddress]);const filterFundedProjects=useCallback(()=>{return projects.filter(project=>(project.status.toLowerCase()==='active'||project.status.toLowerCase()==='funded')&&project.contributors.some(contributor=>contributor.toLowerCase()===userAddress));},[projects,userAddress]);const filterActiveAndFundedProjects=useCallback(()=>{return projects.filter(project=>project.status.toLowerCase()==='active'||project.status.toLowerCase()==='funded');},[projects]);const handleBackToProjects=page=>{setSelectedProject(null);setActivePage(page);};useEffect(()=>{if(activePage==='allProjects'){setFilteredProjects(filterActiveAndFundedProjects());}else if(activePage==='fundedProjects'){setFilteredProjects(filterFundedProjects());}else if(activePage==='myProjects'){setFilteredProjects(filterMyProjects());}},[projects,activePage,userAddress,filterActiveAndFundedProjects,filterFundedProjects,filterMyProjects]);const toggleCreateProject=()=>{setActivePage('createProject');setSelectedProject(null);};const showAllProjects=()=>{setActivePage('allProjects');setSelectedProject(null);// Ensure ProjectDetails is closed\n};const showMyProjects=()=>{setActivePage('myProjects');setSelectedProject(null);// Ensure ProjectDetails is closed\n};const showFundedProjects=()=>{setActivePage('fundedProjects');setSelectedProject(null);// Ensure ProjectDetails is closed\n};const handleProjectClick=project=>{setSelectedProject({...project,isCreator:project.creator.toLowerCase()===userAddress});setActivePage('projectDetails');};const handleSearch=term=>{let projectsToFilter=projects;if(activePage==='myProjects'){projectsToFilter=filterMyProjects();}else if(activePage==='fundedProjects'){projectsToFilter=filterFundedProjects();}else if(activePage==='allProjects'){projectsToFilter=filterActiveAndFundedProjects();}if(!term){setFilteredProjects(projectsToFilter);}else{const lowercasedTerm=term.toLowerCase();const filtered=projectsToFilter.filter(project=>project.projectName.toLowerCase().includes(lowercasedTerm)||project.projectId.toString()===term// 精确匹配ID\n);setFilteredProjects(filtered);}};return/*#__PURE__*/React.createElement(\"div\",{className:\"home-container\"},/*#__PURE__*/React.createElement(Navbar,{onCreateProject:toggleCreateProject,onShowAllProjects:showAllProjects,onShowMyProjects:showMyProjects,onShowFundedProjects:showFundedProjects,onSearch:handleSearch,activePage:activePage}),/*#__PURE__*/React.createElement(\"div\",{className:\"content \".concat(activePage==='createProject'?'centered':'')},selectedProject?/*#__PURE__*/React.createElement(ProjectDetails,{project:selectedProject,onClose:handleBackToProjects,activePage:activePage}):activePage==='createProject'?/*#__PURE__*/React.createElement(CreateProject,null):/*#__PURE__*/React.createElement(ProjectList,{projects:filteredProjects,onProjectClick:handleProjectClick,activePage:activePage})));}export default Home;","map":{"version":3,"names":["React","useState","useEffect","useCallback","axios","ethers","Navbar","ProjectList","ProjectDetails","CreateProject","Home","projects","setProjects","filteredProjects","setFilteredProjects","userAddress","setUserAddress","selectedProject","setSelectedProject","activePage","setActivePage","fetchProjects","response","get","data","error","console","getUserAddress","window","ethereum","request","method","provider","providers","Web3Provider","signer","getSigner","address","getAddress","toLowerCase","filterMyProjects","filter","project","creator","filterFundedProjects","status","contributors","some","contributor","filterActiveAndFundedProjects","handleBackToProjects","page","toggleCreateProject","showAllProjects","showMyProjects","showFundedProjects","handleProjectClick","isCreator","handleSearch","term","projectsToFilter","lowercasedTerm","filtered","projectName","includes","projectId","toString","createElement","className","onCreateProject","onShowAllProjects","onShowMyProjects","onShowFundedProjects","onSearch","concat","onClose","onProjectClick"],"sources":["/Users/matrix/front-end/src/components/Home/Home.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport axios from 'axios';\nimport { ethers } from 'ethers';\nimport Navbar from '../Navbar/Navbar';\nimport ProjectList from '../ProjectList/ProjectList';\nimport ProjectDetails from '../ProjectDetails/ProjectDetails';\nimport CreateProject from '../CreateProject/CreateProject';\nimport './Home.css';\n\nfunction Home() {\n  const [projects, setProjects] = useState([]);\n  const [filteredProjects, setFilteredProjects] = useState([]);\n  const [userAddress, setUserAddress] = useState('');\n  const [selectedProject, setSelectedProject] = useState(null);\n  const [activePage, setActivePage] = useState('allProjects');\n\n  const fetchProjects = async () => {\n    try {\n      const response = await axios.get('/api/projects');\n      setProjects(response.data);\n    } catch (error) {\n      console.error('Error fetching projects:', error);\n    }\n  };\n\n  const getUserAddress = async () => {\n    try {\n      await window.ethereum.request({ method: 'eth_requestAccounts' });\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const signer = provider.getSigner();\n      const address = await signer.getAddress();\n      setUserAddress(address.toLowerCase());\n    } catch (error) {\n      console.error('Error getting user address:', error);\n    }\n  };\n\n  useEffect(() => {\n    fetchProjects();\n    getUserAddress();\n  }, []);\n\n  const filterMyProjects = useCallback(() => {\n    return projects.filter(project => project.creator.toLowerCase() === userAddress);\n  }, [projects, userAddress]);\n\n  const filterFundedProjects = useCallback(() => {\n    return projects.filter(project => \n      (project.status.toLowerCase() === 'active' || project.status.toLowerCase() === 'funded') &&\n      project.contributors.some(contributor => contributor.toLowerCase() === userAddress)\n    );\n  }, [projects, userAddress]);\n\n  const filterActiveAndFundedProjects = useCallback(() => {\n    return projects.filter(project => \n      project.status.toLowerCase() === 'active' || project.status.toLowerCase() === 'funded'\n    );\n  }, [projects]);\n\n  const handleBackToProjects = (page) => {\n    setSelectedProject(null);\n    setActivePage(page);\n  };\n\n  useEffect(() => {\n    if (activePage === 'allProjects') {\n      setFilteredProjects(filterActiveAndFundedProjects());\n    } else if (activePage === 'fundedProjects') {\n      setFilteredProjects(filterFundedProjects());\n    } else if (activePage === 'myProjects') {\n      setFilteredProjects(filterMyProjects());\n    }\n  }, [projects, activePage, userAddress, filterActiveAndFundedProjects, filterFundedProjects, filterMyProjects]);\n\n  const toggleCreateProject = () => {\n    setActivePage('createProject');\n    setSelectedProject(null);\n  };\n\n  const showAllProjects = () => {\n    setActivePage('allProjects');\n    setSelectedProject(null); // Ensure ProjectDetails is closed\n  };\n\n  const showMyProjects = () => {\n    setActivePage('myProjects');\n    setSelectedProject(null); // Ensure ProjectDetails is closed\n  };\n\n  const showFundedProjects = () => {\n    setActivePage('fundedProjects');\n    setSelectedProject(null); // Ensure ProjectDetails is closed\n  };\n\n  const handleProjectClick = (project) => {\n    setSelectedProject({\n      ...project,\n      isCreator: project.creator.toLowerCase() === userAddress\n    });\n    setActivePage('projectDetails');\n  };\n\n\n  const handleSearch = (term) => {\n    let projectsToFilter = projects;\n    if (activePage === 'myProjects') {\n      projectsToFilter = filterMyProjects();\n    } else if (activePage === 'fundedProjects') {\n      projectsToFilter = filterFundedProjects();\n    } else if (activePage === 'allProjects') {\n      projectsToFilter = filterActiveAndFundedProjects();\n    }\n\n    if (!term) {\n      setFilteredProjects(projectsToFilter);\n    } else {\n      const lowercasedTerm = term.toLowerCase();\n      const filtered = projectsToFilter.filter(project =>\n        project.projectName.toLowerCase().includes(lowercasedTerm) ||\n        project.projectId.toString() === term // 精确匹配ID\n      );\n      setFilteredProjects(filtered);\n    }\n  };\n\n  return (\n    <div className=\"home-container\">\n      <Navbar \n        onCreateProject={toggleCreateProject} \n        onShowAllProjects={showAllProjects} \n        onShowMyProjects={showMyProjects}\n        onShowFundedProjects={showFundedProjects}\n        onSearch={handleSearch}\n        activePage={activePage}\n      />\n      <div className={`content ${activePage === 'createProject' ? 'centered' : ''}`}>\n        {selectedProject ? (\n          <ProjectDetails project={selectedProject} onClose={handleBackToProjects} activePage={activePage} />\n        ) : activePage === 'createProject' ? (\n          <CreateProject />\n        ) : (\n          <ProjectList projects={filteredProjects} onProjectClick={handleProjectClick} activePage={activePage} />\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default Home;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}